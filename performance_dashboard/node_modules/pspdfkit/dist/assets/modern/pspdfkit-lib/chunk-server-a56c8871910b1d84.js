/*!
 * PSPDFKit for Web 2021.4.2 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.webpackJsonpPSPDFKit=window.webpackJsonpPSPDFKit||[]).push([[59],{562:function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var s=n(2),i=n.n(s),a=n(4),o=n(1),r=n(3),c=n(18);class d{constructor(){i()(this,"cachedAPStreams",Object(a.b)()),i()(this,"pageAPStreamsPromises",Object(a.b)()),i()(this,"annotationAPStreamPromises",Object(a.b)())}cachedRenderAnnotation(t,e,n,s){var i;const a=this.provider;Object(r.k)(a instanceof a.constructor,"Backend can only use backend annotation provider");const d=t instanceof o.fb?null===(i=a._readStateCallbacks)||void 0===i?void 0:i.getFormFieldByName(t.formFieldName):null,u=!d||d instanceof o.N?null:new o.s({name:d.name,value:void 0!==d.formattedValue?d.formattedValue:"string"==typeof d.value?d.value:d.values});if(!Object(c.t)(t,d))return this.renderAnnotation(t,u,e,n,s);let h=!1,l=()=>{h=!0};return{promise:new Promise((async(i,a)=>{const o=e=>{const n=this.annotationAPStreamPromises.get(t.id);n&&(this.annotationAPStreamPromises=this.annotationAPStreamPromises.delete(t.id),n(e))},r=this.annotationAPStreamPromises.get(t.id);this.annotationAPStreamPromises=this.annotationAPStreamPromises.set(t.id,i),r&&r(null);try{const a=this.pageAPStreamsPromises.get(t.pageIndex);if(!a){const e=new Promise((e=>{this.annotationAPStreamPromises=this.annotationAPStreamPromises.set(t.id,e)}));return void i(await e)}await a;const r=this.cachedAPStreams.get(t.pageIndex);if(r){const e=r?r.get(t.id):null;if(e)return void o(e)}const{promise:c,cancel:d}=this.renderAnnotation(t,u,e,n,s);if(h)o(null);else{l=d;const e=await c;o(e),e&&this.cacheAPStream(e,t)}}catch(t){a(t)}})),cancel:l}}cacheAPStream(t,e){let n=this.cachedAPStreams.get(e.pageIndex);n||(this.cachedAPStreams=this.cachedAPStreams.set(e.pageIndex,Object(a.b)()),n=this.cachedAPStreams.get(e.pageIndex)),Object(r.k)(n);const s=n.get(e.id);s&&s.release(),this.cachedAPStreams=this.cachedAPStreams.setIn([e.pageIndex,e.id],t)}clearAllPageAPStreams(t){const e=this.cachedAPStreams.get(t);e&&(e.forEach((t=>t.release())),this.cachedAPStreams=this.cachedAPStreams.delete(t)),this.pageAPStreamsPromises=this.pageAPStreamsPromises.delete(t)}clearPageAPStreams(t,e){const n=this.cachedAPStreams.get(t);n&&(n.filter(((t,n)=>e.has(n))).forEach((t=>t.release())),this.cachedAPStreams=this.cachedAPStreams.updateIn([t],(t=>t.filter(((t,n)=>!e.has(n))))))}}},563:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=n(132),i=n(4),a=n(3),o=n(246);function r(t){return Object(a.k)(Array.isArray(t),"Wrong `json` field"),Object(i.a)(t.map((t=>(Object(a.k)("number"==typeof t.pageIndex,"Wrong `pageIndex` field"),Object(a.k)("string"==typeof t.previewText,"Wrong `previewText` field"),Object(a.k)(Array.isArray(t.rangeInPreview),"Wrong `rangeInPreview` field"),Object(a.k)(Array.isArray(t.rectsOnPage),"Wrong `rectsOnPage` field"),new o.a({pageIndex:t.pageIndex,previewText:t.previewText,locationInPreview:t.rangeInPreview[0],lengthInPreview:t.rangeInPreview[1],rectsOnPage:Object(i.a)(t.rectsOnPage).map((t=>Object(s.a)(t))),isAnnotation:!!t.isAnnotation,annotationRect:t.annotationRect?Object(s.a)(t.annotationRect):null})))).filter(Boolean))}},564:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var s=n(4),i=n(8);function a(){return!0}class o{constructor(t){this.queue=Object(s.c)(),this.priorityQueue=Object(s.c)(),this.inFlightRequests=Object(s.b)(),this.inflightRequestLimit=t,this.isDestroyed=!1}enqueue(t,e=!1){if(this.isDestroyed)return{promise:new Promise((()=>{})),cancel:()=>{}};let n=null,i=null;const a=new Promise(((t,e)=>{n=t,i=e})),o=e?this.priorityQueue:this.queue,r=Object(s.j)(o,t,{promise:a,resolve:n,reject:i});return e?this.priorityQueue=r:this.queue=r,e?this.next():setTimeout((()=>this.next()),35),{promise:a,cancel:()=>this._cancel(t)}}_cancel(t){this.queue.has(t)&&(this.queue=this.queue.delete(t)),this.priorityQueue.has(t)&&(this.priorityQueue=this.priorityQueue.delete(t)),this.inFlightRequests.has(t)&&(this.inFlightRequests=this.inFlightRequests.delete(t))}cancelAll(){this.queue=Object(s.c)(),this.priorityQueue=Object(s.c)(),this.inFlightRequests=Object(s.b)()}_requestFinished(t,e){if(this.isDestroyed)return;const n=this.inFlightRequests.get(t);n&&(n.resolve(e),this.inFlightRequests=this.inFlightRequests.delete(t)),this.next()}_requestFailed(t,e){if(this.isDestroyed)return;const n=this.inFlightRequests.get(t);n&&(n.reject(e),this.inFlightRequests=this.inFlightRequests.delete(t)),this.next()}next(){if(!(this.isDestroyed||this.inFlightRequests.size>=this.inflightRequestLimit)){if(this.priorityQueue.size>=1){const t=this.priorityQueue.findLastEntry(a);Object(i.a)(t);const[e,n]=t;return this.priorityQueue=this.priorityQueue.delete(e),this.inFlightRequests=this.inFlightRequests.set(e,n),void e.request().then((t=>this._requestFinished(e,t))).catch((t=>this._requestFailed(e,t)))}if(this.queue.size>=1){const t=this.queue.findEntry(a);Object(i.a)(t);const[e,n]=t;this.queue=this.queue.delete(e),this.inFlightRequests=this.inFlightRequests.set(e,n),e.request().then((t=>this._requestFinished(e,t))).catch((t=>this._requestFailed(e,t)))}}}destroy(){this.isDestroyed=!0}}},565:function(t,e,n){"use strict";function s(t,e,n,s,i,a){let o;return t.has(n)?o=t.get(n):(o=i.toString(),e[o]=n,t.set(n,o)),{...s,[a]:o}}n.d(e,"a",(function(){return s}))},566:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));const s={clientsPresenceEnabled:!0,listenToServerChangesEnabled:!0}},649:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return x}));var s=n(2),i=n.n(s),a=n(3);var o=n(1),r=n(299),c=n(145),d=n(18),u=n(179),h=n(4),l=n(9),m=n(563),p=n(132),f=n(41),g=n(259);var w=n(318),P=n(564),b=n(131);class y extends(h.e({authPayload:null,serverUrl:null,documentId:null,backendPermissions:null,documentURL:null,imageToken:null,instantSettings:null,token:null,features:Object(h.a)(),signatureFeatureAvailability:b.a.NONE,isFormsEnabled:!0,minSearchQueryLength:1,documentHandle:null,isDocumentHandleOutdated:!1,digitalSignatures:null,defaultGroup:void 0,hasCollaborationPermissions:!1,forceLegacySignaturesFeature:!1})){}var S=n(202),_=n(122),v=n(230);const R="The image can not be rendered because of an unknown error.";class O{constructor({identifier:t,url:e,token:n,payload:s,doNotRequestWebP:i=!1}){this.identifier=t,this.url=e,this.token=n,this.payload=s,this.doNotRequestWebP=i}abort(){this.httpRequest&&this.httpRequest.abort()}request(){return new Promise(((t,e)=>{const n=new XMLHttpRequest;this.httpRequest=n,n.open(this.payload?"POST":"GET",this.url,!0),n.setRequestHeader("X-PSPDFKit-Image-Token",this.token),_.c&&!this.doNotRequestWebP&&n.setRequestHeader("Accept","image/webp,*/*"),n.responseType="blob",n.onreadystatechange=(async()=>{if(4!==n.readyState)return;if(n.response&&n.response.type.startsWith("application/json")){const s=new FileReader;return s.onload=n=>{var s;const i=JSON.parse(null===(s=n.target)||void 0===s?void 0:s.result);i.attachments_not_found?t({attachmentsNotFound:i.attachments_not_found}):i.error?e(new a.a(`The server could not render the requested image (${i.error})`)):e(new a.a(R))},s.onerror=()=>e(new a.a(R)),void s.readAsText(n.response)}if(!Object(S.a)(n.status))return void e(new a.a(R));const s=n.response,i=URL.createObjectURL(s),o=new Image;o.onerror=()=>e(new a.a(R)),o.src=i;const r="function"==typeof o.decode?o.decode():new Promise((t=>setTimeout(t,200)));await r,t(new v.a(o,(()=>URL.revokeObjectURL(i))))}).bind(this),n.send(this.payload)}))}}var A=n(73),F=n(565),j=n(566),k=n(285),q=n(147),$=n(562),I=n(8);class x extends $.a{constructor(t,e=window){super(),i()(this,"_password",null),i()(this,"type","SERVER"),i()(this,"_requestRenderAnnotation",((t,e,n,s,i,o)=>{const r=`${this._state.documentURL}/render_annotation`,c=`render-annotation-${o?Object(A.a)():t.id}`,d=JSON.stringify({data:Object(f.o)(t),width:s,height:i,detached:o||void 0,formFieldValue:e?Object(f.s)(e):void 0});let u,h,m=!1,p=[];const g=new Promise(((t,e)=>{u=t,h=e})),w=(e=[])=>{const o=new FormData;o.append("render",d),e.length>0&&t.imageAttachmentId&&n&&n.data&&o.append(t.imageAttachmentId,n.data);const f=new O({identifier:c,url:r,token:this._state.imageToken,payload:o,doNotRequestWebP:s>l.E||i>l.E}),g=this._requestQueue.enqueue(f,!1);g.promise.then((t=>{m||(t.attachmentsNotFound?w(t.attachmentsNotFound):t.attachmentsNotFound?h(new a.a("Attachment could not be found.")):u(t))})).catch((t=>{m||h(t)})),p.push(g)};return w(),{promise:g,cancel:()=>{m=!0,p.forEach((t=>t.cancel()))}}})),i()(this,"handleDocumentHandleConflict",(()=>{this._state=this._state.set("isDocumentHandleOutdated",!0),this.cancelRequests(),this._destroyProvider()}));const n=t.serverUrl||Object(c.a)(e.document);if("/"!==n.substr(-1))throw new a.a("`serverUrl` must have a slash at the end (e.g. `https://pspdfkit.example.com/`).");if(!t.serverUrl){if(n===`${e.location.protocol}//${e.location.host}/`)throw new a.a('PSPDFKit automatically infers the URL of PSPDFKit Server from the current `<script>` tag.\nIn the current case, this URL is set to the same as the current browser\'s location.\nThis can happen when you bundle pspdfkit.js with your custom JavaScript for example.\n\nTo make sure everything works as expected, please set the `serverUrl` to the URL of PSPDFKit Server:\n\nPSPDFKit.load({\n  serverUrl: "https://pspdfkit-server.example.com/",\n  ...,\n});')}if("string"!=typeof t.documentId)throw new a.a("`documentId` must be of type string.");if("object"!=typeof t.authPayload||"string"!=typeof t.authPayload.jwt)throw new a.a("authPayload must be an object that contains the `jwt`. For example: `authPayload: { jwt: 'xxx.xxx.xxx'}`");!function(t){const e="The supplied JWT is invalid. Please refer to our guides on how to set up authentication:\n  https://pspdfkit.com/guides/web/current/server-backed/client-authentication/";if(-1!==t.indexOf('{"internal":'))return;let n;Object(a.k)("string"==typeof t&&3===t.split(".").length,e);try{const e=g.Base64.decode(t.split(".")[1]);n=JSON.parse(e)}catch(t){throw new a.a(e)}Object(a.k)("string"==typeof n.document_id,"The supplied JWT is invalid. The field 'document_id' has to be a string value.\n  Please refer to our guides for further information: https://pspdfkit.com/guides/web/current/server-backed/client-authentication/")}(t.authPayload.jwt),function(t){let e="";if("boolean"!=typeof t&&(Object(a.l)(t)?(t.hasOwnProperty("clientsPresenceEnabled")&&"boolean"!=typeof t.clientsPresenceEnabled&&(e+="`clientsPresenceEnabled` in instance settings is not valid. Must be `true` or `false`.\n"),t.hasOwnProperty("listenToServerChangesEnabled")&&"boolean"!=typeof t.listenToServerChangesEnabled&&(e+="`listenToServerChangesEnabled` in instance settings is not valid. Must be `true` or `false`.\n")):e="`instant` flag must either be set to `true` or `false`\n",e))throw new a.a(`${e}\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/`)}(t.instant);let s=null;if(t.instant)if(Object(a.l)(t.instant)){const e=t.instant;s={clientsPresenceEnabled:!1!==e.clientsPresenceEnabled,listenToServerChangesEnabled:!1!==e.listenToServerChangesEnabled}}else s=j.a;this._requestQueue=new P.a(l.C);const o=!!t.electronicSignatures&&Boolean(t.electronicSignatures.forceLegacySignaturesFeature);this._state=new y({serverUrl:n,documentId:t.documentId,instantSettings:s,documentURL:`${n}i/d/${t.documentId}`,authPayload:t.authPayload,isFormsEnabled:!t.disableForms,forceLegacySignaturesFeature:o}),t.trustedCAsCallback&&Object(a.p)("PSPDFKit.Configuration#trustedCAsCallback is only used on Standalone deployments. On a Server-backed deployment, please follow the instructions at https://pspdfkit.com/guides/web")}isUsingInstantProvider(){return null!=this._state.instantSettings}hasClientsPresence(){const t=this._state.instantSettings;return null!=t&&!1!==t.clientsPresenceEnabled}async load(t={}){const{imageToken:e,token:n,permissions:s,features:i,signatureFeatureAvailability:r,hasPassword:c,minSearchQueryLength:d,layerHandle:u,allowedTileScales:l,digitalSignatures:m,defaultGroup:p,collaborationPermissions:g,creatorName:w}=await async function(t,e,n){const s=await fetch(`${t}/auth`,{method:"POST",headers:{"Content-Type":"application/json","PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=4, client=2021.4.2, client-git=12fc65bf3a"},body:JSON.stringify({jwt:e.jwt,origin:window.location.href,password:n}),credentials:"include"});return s.ok?s.json():s.text().then((t=>{throw"INVALID_PASSWORD"===t?new a.a(t):new a.a(`An error occurred while connecting to PSPDFKit Server: ${t||s.statusText}`)}))}(`${this._state.serverUrl}i/d/${this._state.documentId}`,this._state.authPayload,t.password);if(this._password=t.password,this._state.instantSettings&&!i.includes(o.z.INSTANT))throw new a.a("Instant feature is not enabled on this server. Please set `instant` to `false`.\n\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/");const P=r===b.a.ELECTRONIC_SIGNATURES&&i.includes(o.z.WEB_ANNOTATION_EDITING)&&this._state.forceLegacySignaturesFeature?b.a.LEGACY_SIGNATURES:r;if(this._state=this._state.withMutations((t=>t.set("imageToken",e).set("token",n).set("features",Object(h.a)(i)).set("signatureFeatureAvailability",P).set("backendPermissions",new o.c({readOnly:-1===s.indexOf("write"),downloadingAllowed:s.indexOf("download")>=0})).set("documentURL",`${this._state.serverUrl}i/d/${this._state.documentId}/h/${u}`).set("documentHandle",u).set("isDocumentHandleOutdated",!1).set("digitalSignatures",Object(f.g)(m)))),g&&!this._state.instantSettings)throw new a.a("Collaboration Permissions is not supported when `instant` is disabled. Please make sure `configuration#instant` is set to `true`.");return this._state=this._state.withMutations((t=>{t.defaultGroup=p,t.hasCollaborationPermissions=Boolean(g)})),this.provider&&this.provider.destroy(),this.provider=await this._initProvider(),this._state.instantSettings&&this.provider.setDocumentHandleConflictCallback(this.handleDocumentHandleConflict),{features:this._state.features,signatureFeatureAvailability:this._state.signatureFeatureAvailability,hasPassword:c,minSearchQueryLength:d,allowedTileScales:l,jsActionChanges:[],creatorName:w,defaultGroup:p}}async _initProvider(){if(this._state.instantSettings){const t=`${this._state.serverUrl}i/d/${this._state.documentId}/h/${this._state.documentHandle}`,{InstantProvider:e}=await n.e(60).then(n.bind(null,647));return new e(`${this._state.serverUrl}i/d/${this._state.documentId}`,t,{auth_token:this._state.token},this._state.instantSettings)}{const t=this._state.isFormsEnabled&&this._state.features.includes(o.z.FORMS),{RESTProvider:e}=await n.e(61).then(n.bind(null,650));return new e(this._state.documentURL,{token:this._state.token},{isFormsEnabled:t})}}destroy(){this._destroyProvider(),this._requestQueue&&this._requestQueue.destroy()}documentInfo(){return this._fetch(`${this._state.documentURL}/document.json`).then((t=>t.json())).then((t=>(t.data.totalPages=t.data.pageCount,t.data)))}getFormJSON(){return this._fetch(`${this._state.documentURL}/form.json`).then((t=>403===t.status?{v:1,type:"pspdfkit/form",annotations:[],fields:[]}:t.json().then((t=>t.data))))}async evalFormValuesActions(){throw new Error("not implemented")}async evalScript(){throw new Error("not implemented")}permissions(){return Promise.resolve(this._state.backendPermissions)}getDefaultGroup(){return this._state.defaultGroup}isCollaborationPermissionsEnabled(){return this._state.hasCollaborationPermissions}textForPageIndex(t){const e=`${this._state.documentURL}/page-${t}-text`,n=new(this._getJSONRequestHandler())(e,this._state.token),s=this._requestQueue.enqueue(n,!0);return{promise:s.promise.then((e=>Object(u.b)(e,t))),cancel:()=>{s.cancel()}}}getTextFromRects(t,e){const n=encodeURIComponent(JSON.stringify(e.map(p.b).toArray()));return this._fetch(`${this._state.documentURL}/page-${t}-highlighted?rects=${n}`).then((t=>t.json())).then((t=>t.text))}_getJSONRequestHandler(){return w.a}renderTile(t,e,n,s,i){if(this._state.isDocumentHandleOutdated)return{promise:new Promise((()=>{})),cancel:()=>{}};const o=`${this._state.documentURL}/page-${t}-dimensions-${e.width}-${e.height}-tile-${n.left}-${n.top}-${n.width}-${n.height}${s?"-print":""}`,r=e.width===n.width&&e.height===n.height,c=n.width>l.E||n.height>l.E;let u,h,m=!1,p=!1,g=[],w=[];const P=new Promise(((t,e)=>{u=t,h=e})),b=(t=[])=>{let e;if(i){const n=new FormData;n.append("data",JSON.stringify({annotations:i.annotations.filter(d.u).map(f.o).toJS().map((t=>({content:t}))),formFieldValues:i.formFieldValues.map(f.s).toJS(),formFields:i.formFields.map(f.r).toJS(),signatures:i.signatures||[]})),t.length>0&&t.forEach((t=>{const e=i.attachments.get(t);Object(I.a)(e&&e.data,"Attachment data could not be found."),n.append(t,e.data)})),e=new O({identifier:o,url:o,token:this._state.imageToken,payload:n,doNotRequestWebP:c})}else e=new O({identifier:o,url:o,token:this._state.imageToken,doNotRequestWebP:c});w.push(e);const n=this._requestQueue.enqueue(e,r);n.promise.then((t=>{if(!m)return t.attachmentsNotFound&&!p?(p=!0,void b(t.attachmentsNotFound)):void(t.attachmentsNotFound?h(new a.a("Attachment could not be found.")):u(t))})).catch((t=>{m||h(t)})),g.push(n)};return b(),{promise:P,cancel:()=>{m=!0,w.forEach((t=>{t.abort&&"function"==typeof t.abort&&t.abort()})),g.forEach((t=>t.cancel()))}}}renderAnnotation(t,e,n,s,i){return this._requestRenderAnnotation(t,e,n,s,i)}renderPageAnnotations(t){const e=Promise.resolve();return this.pageAPStreamsPromises=this.pageAPStreamsPromises.set(t,e),e}renderDetachedAnnotation(t,e,n,s){return this._requestRenderAnnotation(t,null,e,n,s,!0)}async getAttachment(t){try{const e=await this._fetch(`${this._state.documentURL}/attachments/${t}`);switch(e.status){case 404:throw new a.a("Attachment not Found.");case 200:return await e.blob();default:throw new a.a("Bad Request.")}}catch(t){throw new a.a(`Could not fetch attachment from PSPDFKit Server. ${t}`)}}async search(t,e,n,s,i=!1,a=q.a.TEXT){const o=`q=${a===q.a.PRESET?t.replace(/_/g,"-"):encodeURIComponent(t)}&start=${e}&limit=${n}&type=${a}&include_annotations=${i.toString()}&case_sensitive=${s.toString()}`,r=`${this._state.documentURL}/search?${o}`,c=await new w.a(r,this._state.token).request();return Object(m.a)(c.data)}async searchAndRedact(t,e){const{searchType:n,annotationPreset:s,searchInAnnotations:i,caseSensitive:a}=e,{color:o,fillColor:r,outlineColor:c,...d}=s,u=await this._fetch(`${this._state.documentURL}/redactions`,{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy:n,strategyOptions:{[n]:n===q.a.PRESET?t.replace(/_/g,"-"):t,includeAnnotations:i,caseSensitive:a},content:{...d,color:o&&o.toHex(),fillColor:r&&r.toHex(),outlineColor:c&&c.toHex()}})}),{data:l}=await u.json();return Object(h.a)(l&&l.annotations?l.annotations.map((t=>k.a.fromJSON(t.id,t.content))):[])}exportPDF({flatten:t=!1,includeComments:e=!0}={}){const n=`${this._state.documentURL}/pdf?token=${this._state.token}&flatten=${String(t)}&comments=${String(e)}&render_ap_streams=${String(!t)}`;return fetch(n,{method:"GET",credentials:"include"}).then((t=>t.arrayBuffer()))}exportXFDF(){return this._fetch(`${this._state.documentURL}/document.xfdf`).then((t=>t.text()))}exportInstantJSON(){return this._fetch(`${this._state.documentURL}/instant.json`).then((t=>t.json()))}getPDFURL({includeComments:t=!0}={}){return{promise:Promise.resolve(`${this._state.documentURL}/pdf?token=${this._state.token}&flatten=true&comments=${String(t)}`),revoke:()=>{}}}generatePDFObjectURL({includeComments:t=!0}={}){let e,n=!1;return{promise:new Promise((s=>{this.exportPDF({flatten:!0,includeComments:t}).then((t=>{if(n)return;const i=new Blob([t],{type:"application/pdf"});e=window.URL.createObjectURL(i),s(e)}))})),revoke:()=>{e&&window.URL.revokeObjectURL(e),n=!0}}}async getDocumentOutline(){let t;try{t=(await this._fetch(`${this._state.documentURL}/outline.json`).then((t=>t.json()))).data}catch(e){t={}}const e=Array.isArray(t.outline)?t.outline:[];return Object(h.a)(e.map(r.a))}onKeystrokeEvent(){throw new Error("not implemented")}async applyOperationsAndReload(t){try{const e=await T(t);this._destroyProvider(),await this._fetch(`${this._state.documentURL}/apply-operations`,{method:"post",body:e,credentials:"include"})}catch(t){throw new a.a(`Applying operations failed: ${t}`)}return this.reloadDocument()}async applyRedactionsAndReload(){try{return this._destroyProvider(),await this._fetch(`${this._state.documentURL}/redact`,{method:"post",credentials:"include"}),this.reloadDocument()}catch(t){throw this.provider.load(),new a.a(`Applying redactions failed: ${t}`)}}async reloadDocument(){try{return await this.load({password:this._password})}catch(t){throw new a.a(`Reloading the document failed: ${t}`)}}async exportPDFWithOperations(t){try{const e=await T(t);return this._fetch(`${this._state.documentURL}/pdf-with-operations`,{method:"post",body:e,credentials:"include"}).then((t=>t.arrayBuffer()))}catch(t){throw new a.a(`Exporting PDF with operations failed: ${t}`)}}async getSignaturesInfo(){return this._refreshSignaturesInfoPromise&&await this._refreshSignaturesInfoPromise,this._state.digitalSignatures}refreshSignaturesInfo(){return this._refreshSignaturesInfoPromise||(this._refreshSignaturesInfoPromise=new Promise(((t,e)=>{this._fetch(`${this._state.documentURL}/signatures`,{method:"get",credentials:"include"}).then((t=>t.json())).then((({data:e})=>{this._state=this._state.set("digitalSignatures",Object(f.g)(e)),this._refreshSignaturesInfoPromise=null,t()})).catch((t=>{this._state=this._state.set("digitalSignatures",null),this._refreshSignaturesInfoPromise=null,e(t)}))}))),this._refreshSignaturesInfoPromise}async signDocumentAndReload(t,e){try{if(void 0!==e&&"object"!=typeof e)throw new a.a("Signing service data must be an object if specified.");const n={};t&&"placeholderSize"in t&&(n.signerDataSource={estimatedSize:t.placeholderSize}),t&&"flatten"in t&&(n.flatten=t.flatten);const s={...e?{signingToken:e.signingToken}:null,...n};this._destroyProvider(),await this._fetch(`${this._state.documentURL}/sign`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"}),await this.reloadDocument()}catch(t){throw this.provider.load(),new a.a(`Adding digital signature failed: ${t.message||t}`)}}getDocumentHandle(){return this._state.documentHandle}cancelRequests(){this._requestQueue.cancelAll()}_destroyProvider(){this.provider&&(this.provider._clients&&this.provider._clients.disconnect(),this.provider.destroy())}async _fetch(t,e){const n=await fetch(t,{...e,headers:{...null==e?void 0:e.headers,"X-PSPDFKit-Token":this._state.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=4, client=2021.4.2, client-git=12fc65bf3a"}});if(!n.ok){let t=await function(t){return t.clone().json().catch((()=>t.text()))}(n);t="object"==typeof t?t.reason:t;const e=t||`${n.status} ${n.statusText}`;throw new a.a(e)}return n}syncChanges(){return this.provider.syncChanges()}async clearAPStreamCache(){}}async function T(t){const e={},n=new WeakMap,s=await Promise.all(t.map((async(t,s)=>{if("importDocument"===t.type){const i=t.document;return Object(I.a)(i instanceof File||i instanceof Blob,"Wrong `importDocument` operation `document` value: it must be a File or a Blob"),Object(F.a)(n,e,i,t,s,"document")}if("applyInstantJson"===t.type){const i=t.instantJson;Object(I.a)("object"==typeof i&&null!==i,"Wrong `applyInstantJson` operation `instantJson` value: it must be an object");const a=JSON.stringify(i),o=new Blob([a],{type:"application/json"});return Object(F.a)(n,e,o,t,s,"dataFilePath")}if("applyXfdf"===t.type){const i=t.xfdf;Object(I.a)("string"==typeof i,"Wrong `applyXfdf` operation `xfdf` value: it must be a string");const a=new Blob([i],{type:"application/vnd.adobe.xfdf"});return Object(F.a)(n,e,a,t,s,"dataFilePath")}return t}))),i=new FormData;i.append("operations",JSON.stringify({operations:s}));for(const t in e)i.append(t,e[t]);return i}}}]);