/*!
 * PSPDFKit for Web 2021.4.2 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.webpackJsonpPSPDFKit=window.webpackJsonpPSPDFKit||[]).push([[60],{647:function(e,t,s){"use strict";s.r(t),s.d(t,"InstantProvider",(function(){return z}));var i=s(2),n=s.n(i),a=s(4),o=s(3),c=s(41),r=s(125),l=s(229);class d extends(a.e({clientId:"",userId:null,presenceContent:{}})){}class h extends(a.e({status:"offline",currentClient:null,clients:Object(a.b)()})){}var u=s(145),m=s(146);class b{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,this.timer&&clearTimeout(this.timer)}scheduleTimeout(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}var p=s(8);const _="0.0.1",k=0,f=1,g=2,C={name:"PSPDFKit-Web"},j=e=>[1e3,2e3][e-1]||5e3;function O(e){return Object(o.k)("string"==typeof e.client_id,"The client payload must have a `client_id`"),Object(o.k)("object"==typeof e.presence,"The client payload must have a `presence`"),new d({clientId:e.client_id,userId:e.user_id,presenceContent:e.presence})}var F=s(319);class y extends(a.e({content:null,attachments:null,id:null,type:null,group:void 0,resolve:()=>{},reject:()=>{}})){}var w=s(300);class I extends(a.e({requestInfo:null,status:"offline",currentClient:null,localRecordsContents:Object(a.c)(),localRecordsChanges:Object(a.a)(),stagedRecordsChanges:Object(a.a)(),localRecordsRev:0,requiredAttachmentIds:Object(a.g)(),clients:Object(a.b)()})){}var v=s(260);var R=s(566),x=s(175);function S(e,t){const s=e.get("annotations"),i=e.get("formFields"),n=e.get("comments"),a=e.get("formattedFormFieldValues");let o;return t.id.startsWith("form-field-value/")&&(o=t.id.split("/")[1]),s.get(t.id)||i.find((e=>e.id===t.id))||n.get(t.id)||(o?a.get(o):void 0)}function P(e,t){return Boolean(S(e,t))}var q=s(51),A=s(158),E=s(81),T=s(127),U=s(1),V=s(32),B=s(27);class z{constructor(e,t,s,i=R.a){n()(this,"_existingBookmarksIds",Object(a.g)()),n()(this,"_existingFormFieldsIds",Object(a.g)()),n()(this,"_existingFormFieldValuesIds",Object(a.g)()),n()(this,"_existingCommentIds",Object(a.g)()),n()(this,"_documentHandleConflictCallback",(()=>{})),n()(this,"canCreateBackendOrphanWidgets",!0),n()(this,"setDocumentHandleConflictCallback",(e=>{this._documentHandleConflictCallback=e})),n()(this,"setDocumentHandleOutdated",(e=>{this._setDocumentHandleOutdatedCallback=e})),n()(this,"onDocumentHandleConflict",(()=>{this._documentHandleConflictCallback&&this._documentHandleConflictCallback(),this._setDocumentHandleOutdatedCallback&&this._setDocumentHandleOutdatedCallback(!0)})),this._serverURL=e,this._documentURL=t,this._authPayload=s,this._settings=i,this._hasLoadedInitialRecords=!1}load(e=class{getRecords(){return this._shouldFireRecordsUpdateCallback=!0,this._state.localRecordsContents.map(((e,t)=>{const{content:s,permissions:i,group:n}=e;return{content:s,permissions:i,group:n,id:t}})).toList()}createRecord(e,t,s,i){return new Promise(((n,a)=>{const o=new y({id:e,content:t,attachments:s,group:i,type:"created",resolve:n,reject:a});this.enqueueChangeRequest(o)}))}updateRecord(e,t,s){return new Promise(((i,n)=>{if(!this.isKnownRecordId(e))return n(new o.a(`Record with ID: ${e} not found.`));const a=new y({id:e,content:t,group:s,type:"updated",resolve:i,reject:n});this.enqueueChangeRequest(a)}))}deleteRecord(e){return new Promise(((t,s)=>{if(!this.isKnownRecordId(e))return s(new o.a(`Record with ID: ${e} not found.`));const i=new y({id:e,type:"deleted",resolve:t,reject:s});this.enqueueChangeRequest(i)}))}onRecordsUpdates(e,t){if("function"!=typeof e)throw new TypeError("recordsUpdateCallback must be a function");if("function"!=typeof t)throw new TypeError("acceptedRecordsCallback must be a function");this._recordsUpdatesCallback=e,this._acceptedRecordsResponseCallback=t}destroy(){this._cycle&&this._cycle.destroy()}constructor(e=new I,t=w.b){n()(this,"_recordsUpdatesCallback",(()=>{})),n()(this,"_acceptedRecordsResponseCallback",(()=>{})),n()(this,"_shouldFireRecordsUpdateCallback",!1),n()(this,"onChanges",(e=>{if(this._shouldFireRecordsUpdateCallback){const{created:t,updated:s,deleted:i}=e;this._recordsUpdatesCallback(Object(a.a)(t),Object(a.a)(s),Object(a.a)(i))}})),n()(this,"onAcceptedRecords",(e=>{if(this._shouldFireRecordsUpdateCallback){const{created:t,updated:s,deleted:i}=e;this._acceptedRecordsResponseCallback(Object(a.a)(t),Object(a.a)(s),Object(a.a)(i))}})),n()(this,"setOnDocumentHandleConflictCallback",(e=>{if("function"!=typeof e)throw new TypeError("callback must be a function");this._cycle.setOnDocumentHandleConflictCallback(e)})),n()(this,"syncChanges",Object(v.a)((()=>this._cycle.nextCycle()))),this._state=e,this._CycleClass=t}load(e,t,s=!0){return new Promise(((i,n)=>{const a=this.setState.bind(this);this.setState(this._state.set("requestInfo",{serverURL:e,authPayload:t})),this._cycle=new this._CycleClass({getState:()=>this._state,setState:a,onChanges:this.onChanges,onAcceptedRecords:this.onAcceptedRecords,longPollingTimeout:s?w.a:0}),this._cycle.nextCycle(0).then((()=>{i(this)})).catch(n)}))}setState(e){this._state=e}enqueueChangeRequest(e){const t=Object(F.a)({oldChanges:this._state.localRecordsChanges,newChanges:Object(a.a)([e])});this.setState(this._state.set("localRecordsChanges",t))}isKnownRecordId(e){function t(t){return"created"===t.type&&t.id===e}const s=this._state.localRecordsContents.has(e),i=!!this._state.localRecordsChanges.find(t),n=!!this._state.stagedRecordsChanges.find(t);return s||i||n}},t=class{constructor(e=new h,t=class{constructor(e,t,{reconnectTimerCalc:s=j,enableReconnect:i=!0,events:n=[]}={}){this.eventEmitter=new m.a(["connect","disconnect","error"].concat(n)),this.serverURL=e,this.authPayload=t,this.socket=null,this.lastRequestId=0,this.requestsWaitingForAnswers=Object(a.b)(),i&&(this.reconnectTimer=new b((()=>{this.socket&&(this.socket.close(),this.socket=null),this.connect()}),s)),this.clearAuthenticationInformation()}registerEvents(e){this.eventEmitter.events.push(...e)}connect(){if(this.socket)return;const e=new WebSocket(this.serverURL);e.onopen=this.onOpen.bind(this),e.onmessage=this.onMessage.bind(this),e.onerror=()=>{this.socket=null,this.eventEmitter.emit("error",`Failed to create the WebSocket connection to ${this.serverURL}. Please check your firewall or proxy settings.`)},this.socket=e}disconnect(){this.socket&&(this.socket.onclose=()=>{},this.socket.close(),this.clearAuthenticationInformation(),this.abortOpenRequests(),this.eventEmitter.emit("disconnect"))}get connectionState(){switch(this.socket&&this.socket.readyState){case k:return"connecting";case f:return"open";case g:return"closing";default:return"closed"}}get isAuthenticated(){return""!==this.clientId}sendRequest(e,t){return new Promise(((s,i)=>{if(!this.isAuthenticated||!this.socket)return void i(new o.a("Cannot send request when the connection is not authenticated"));const n=this.nextRequestId(),a=JSON.stringify(t);this.requestsWaitingForAnswers=this.requestsWaitingForAnswers.set(n,{resolve:s,reject:i}),this.socket.send(`${n}:${e}:${a}`)}))}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}onOpen(){const e=this.socket;e&&(e.onerror=this.onError.bind(this),e.onclose=this.onClose.bind(this))}onMessage(e){const t=e.data;if(this.isAuthenticated){const e=this.parseFrame(t);if(e.requestId){const t=e.requestId;Object(p.a)(this.requestsWaitingForAnswers.has(t),"Received a reply with an unknown request ID.");const s=this.requestsWaitingForAnswers.get(t);switch(Object(p.a)(s),e.action){case"ok":s.resolve(e.payload);break;case"error":s.reject(new o.a(e.payload.reason||"Unknown error"));break;default:Object(p.a)(!1,`${e.action} is not a valid request reply`)}this.requestsWaitingForAnswers=this.requestsWaitingForAnswers.delete(t)}else this.eventEmitter.events.includes(e.action)&&this.eventEmitter.emit(e.action,e.payload),this.log("incoming info message",e)}else{const e=this.parseUnauthenticatedFrame(t);switch(e.action){case"hello":this.onHello(e.payload);break;case"authenticated":this.onAuthenticated(e.payload);break;case"error":this.eventEmitter.emit("error",e.payload.reason||"Unknown error")}}}onClose(e){this.clearAuthenticationInformation(),this.abortOpenRequests(),this.reconnectTimer&&this.reconnectTimer.scheduleTimeout(),this.eventEmitter.emit("disconnect"),this.log("close",e)}onError(e){this.reconnectTimer&&this.reconnectTimer.scheduleTimeout(),this.log("error",e)}nextRequestId(){const e=this.lastRequestId+1;return this.lastRequestId=e,e}onHello(e){const t=this.socket;if(2===e.protocol_version){const e={protocol_version:2,client_version:_,client_info:C,auth_payload:this.authPayload};t.send(`hello_web:${JSON.stringify(e)}`)}else t.send(`handshake_failed:${JSON.stringify({reason:"protocol_mismatch",protocol_version:2,client_version:_,client_info:C})}`),this.eventEmitter.emit("error","protocol_mismatch")}onAuthenticated(e){Object(p.a)(e.client_id,"`authenticated` message has no `client_id`"),this.clientId=e.client_id,this.userId=e.user_id||null,this.eventEmitter.emit("connect",{clientId:this.clientId,userId:this.userId})}log(...e){"development"===Object(u.b)()&&console.log("SYNCConnection",...e)}parseFrame(e){const[,t,s,i]=/^(\d+|info):([a-zA-Z-_]+):(.+)$/.exec(e.toString());let n=null;return"info"!==t&&(n=parseInt(t)),{requestId:n,action:s,payload:JSON.parse(i)}}parseUnauthenticatedFrame(e){const[,t,s]=/^(hello|authenticated|error):(.+)$/.exec(e.toString());return{action:t,payload:JSON.parse(s)}}abortOpenRequests(){this.requestsWaitingForAnswers.forEach((e=>{e.reject(new o.a("request aborted"))})),this.requestsWaitingForAnswers=Object(a.b)()}clearAuthenticationInformation(){this.clientId="",this.userId=null}}){this.state=e,this.connectionClass=t}load(e,t,s){return new Promise(((i,n)=>{this.setState=e=>{this.state=e},this.connection=new this.connectionClass(e,t,{events:["client_presence"]}),this.connection.on("connect",(e=>{const t=new d({clientId:e.clientId,userId:e.userId,presenceContent:s});this.setState(this.state.set("status","online").set("currentClient",t)),this.populateClients(s).then((()=>{i(this)})).catch(n)})),this.connection.on("error",(e=>{n(new o.a(e.toString()))})),this.connection.on("client_presence",(e=>this.onInfoClientPresence(e))),this.connection.connect()}))}populateClients(e){return new Promise(((t,s)=>{this.connection.sendRequest("enter_layer",{presence:e}).then((e=>{this.setState(function(e,t){return Object(p.a)(t.clients,"The payload must have a `clients` list"),e.withMutations((s=>{var i;const n=Object(a.b)(t.clients.map((e=>O(e))).map((e=>[e.clientId,e]))).set(null===(i=e.currentClient)||void 0===i?void 0:i.clientId,e.currentClient);s.set("clients",n)}))}(this.state,e)),t()})).catch(s)}))}onInfoClientPresence(e){if(this.setState(function(e,t){Object(p.a)("object"==typeof t.clients,"The payload must have `clients`");const s=e.clients.withMutations((s=>{if(t.clients.entered)for(const i of t.clients.entered){if(e.clients.has(i.client_id))throw new o.a("The client marked as entered is already known");const t=O(i);s.set(t.clientId,t)}if(t.clients.updated)for(const i of t.clients.updated){Object(p.a)("string"==typeof i.client_id,"The client payload must have a `client_id`"),Object(p.a)("object"==typeof i.presence,"The client payload must have a `presence`");const t=e.clients.get(i.client_id);if(!t)throw new o.a("The client marked as updated is not known");s.set(t.clientId,t.set("presenceContent",i.presence))}if(t.clients.left)for(const i of t.clients.left){if(!e.clients.has(i))throw new o.a("The client marked as left is not known");s.delete(i)}}));return e.set("clients",s)}(this.state,e)),this.shouldFireClientUpdatesCallback){let t=Object(a.b)();if(e.clients.entered){const s=e.clients.entered.map((e=>e.client_id));t=this.state.clients.filter((e=>-1!==s.indexOf(e.clientId))).toMap()}let s=Object(a.b)();if(e.clients.updated){const t=e.clients.updated.map((e=>e.client_id));s=this.state.clients.filter((e=>-1!==t.indexOf(e.clientId))).toMap()}let i=Object(a.a)();e.clients.updated&&(i=Object(a.a)(e.clients.left)),this.clientUpdatesCallback(t,s,i)}}disconnect(){"offline"!==this.getStatus()&&(this.setState(this.state.set("status","offline")),this.connection.disconnect())}getStatus(){return this.state.status}getCurrentClient(){return this.state.currentClient}getClients(){return this.shouldFireClientUpdatesCallback=!0,this.state.clients}updatePresence(e){return new Promise(((t,s)=>{if("online"!==this.getStatus())return s(new o.a("ClientsPresence is not connected"));this.connection.sendRequest("update_client_presence",{presence:e}).then((()=>{this.setState(function(e,t){var s;return e.setIn(["currentClient","presenceContent"],t).setIn(["clients",null===(s=e.currentClient)||void 0===s?void 0:s.clientId,"presenceContent"],t)}(this.state,e)),t(!0)}),(()=>{s(new o.a("Unable to update presence"))}))}))}onClientUpdates(e){if("function"!=typeof e)throw new TypeError("callback must be a function");this.clientUpdatesCallback=e}}){const s=[];return this._sync=new e,s.push(this._sync.load(`${this._documentURL}/sync`,this._authPayload,this._settings.listenToServerChangesEnabled).catch(o.i)),this._sync.setOnDocumentHandleConflictCallback(this.onDocumentHandleConflict),this._settings.clientsPresenceEnabled&&(this._clients=new t,s.push(this._clients.load(`${this._serverURL.replace(/^http/i,"ws")}/websocket`,this._authPayload,{}).then((()=>{const e=this._clients;null!=e&&(e.onClientUpdates((()=>this._onClientsChange(e.getClients()))),this._onClientsChange(e.getClients()))})).catch((e=>{Object(o.p)("PSPDFKit: An error occurred while initializing the connected clients module. This might be due to a lack of support for WebSockets or a related failure.\n\nFailure details:\n\n"+e.message)})))),Promise.all(s).then((()=>this)).catch((e=>{throw new o.a(`Initialization of PSPDFKit Instant failed:\n${e.message}`)}))}destroy(){this._sync&&this._sync.destroy()}setFormsEnabledInConfig(e){this._formsEnabledInConfig=e}setReadStateCallbacks(e){this._readStateCallbacks=e}setAnnotationCallbacks(e){this._annotationCallbacks=e}setBookmarkCallbacks(e){this._bookmarkCallbacks=e}setFormFieldCallbacks(e){this._formFieldCallbacks=e}setFormFieldValueCallbacks(e){this._formFieldValueCallbacks=e}setCommentCallbacks(e){this._commentCallbacks=e}createAnnotation(e,t){const{id:s,...i}=Object(c.o)(e),{group:n,permissions:a,...o}=i;return this._sync.createRecord(s,o,Object(c.b)(t),n)}createComment(e){const{id:t,...s}=Object(c.p)(e),{group:i,permissions:n,...a}=s;return this._existingCommentIds=this._existingCommentIds.add(t),this._sync.createRecord(t,a,{},i)}async updateComment(e){try{return await this.updateRecord(Object(c.p)(e))}catch(e){if(!(e instanceof o.a))throw e}}deleteComment(e){return this._existingCommentIds=this._existingCommentIds.delete(e),this._sync.deleteRecord(e).then((()=>{}))}setStateGetter(e){this._getState=e}async updateRecord(e){var t;const{id:s,permissions:i,group:n,...a}=e;return this._getState&&this._getState()&&null!==(t=this._getState().backend)&&void 0!==t&&t.isCollaborationPermissionsEnabled()?this._sync.updateRecord(s,i.edit?a:void 0,i.setGroup?n:void 0):this._sync.updateRecord(s,a,n)}async updateAnnotation(e){try{return await this.updateRecord(Object(c.o)(e))}catch(e){if(!(e instanceof o.a))throw e}}deleteAnnotation(e){return this._sync.deleteRecord(e.id).then((()=>{}))}createBookmark(e){const{id:t,...s}=Object(r.b)(e);return this._existingBookmarksIds=this._existingBookmarksIds.add(t),this._sync.createRecord(t,s,{})}async updateBookmark(e){const{id:t,...s}=Object(r.b)(e);try{return await this._sync.updateRecord(t,s)}catch(e){if(!(e instanceof o.a))throw e}}deleteBookmark(e){return this._sync.deleteRecord(e).then((()=>{this._existingBookmarksIds=this._existingBookmarksIds.delete(e)}))}createFormField(e){const{id:t,...s}=Object(c.r)(e),{group:i,permissions:n,...a}=s;return this._existingFormFieldsIds=this._existingFormFieldsIds.add(t),this._sync.createRecord(t,a,{},i)}async updateFormField(e){try{return await this.updateRecord(Object(c.r)(e))}catch(e){if(!(e instanceof o.a))throw e}}deleteFormField(e){return this._sync.deleteRecord(e.id).then((()=>{this._existingFormFieldsIds=this._existingFormFieldsIds.delete(e.id)}))}loadFormFields(){return this.loadAnnotationsForPageIndex()}createFormFieldValue(e){const t=Object(c.s)(e),s=Object(x.b)(e);return this._existingFormFieldValuesIds=this._existingFormFieldValuesIds.add(s),this._sync.createRecord(s,t,{})}async setFormFieldValue(e){const t=Object(c.s)(e);try{return await this._sync.updateRecord(Object(x.b)(e),t)}catch(e){if(!(e instanceof o.a))throw e}}deleteFormFieldValue(e){return this._sync.deleteRecord(e).then((()=>{this._existingFormFieldValuesIds=this._existingFormFieldValuesIds.delete(e)}))}loadAnnotationsForPageIndex(){return this._loadPromise||(this._loadPromise=new Promise((e=>setTimeout(e,0))).then((()=>{this._hasLoadedInitialRecords||(this._sync.onRecordsUpdates(((e,t,s)=>this._onRecordsUpdates(e,t,s,l.b)),((e,t,s)=>this._onAcceptedRecords(e,t,s))),this._onRecordsUpdates(this._sync.getRecords(),Object(a.a)(),Object(a.a)(),l.a),this._hasLoadedInitialRecords=!0)}))),this._loadPromise}async loadBookmarks(){}syncChanges(){return this._sync.syncChanges()}_filterRecords(e){return e.filter((({content:e})=>this._formsEnabledInConfig||!Object(c.l)(e)))}_onRecordsUpdates(e,t,s,i){let n=Object(a.a)();const l=[];let d=Object(a.a)(),h=Object(a.a)(),u=Object(a.g)(),m=Object(a.g)(),b=Object(a.g)(),p=Object(a.g)(),_=Object(a.g)();const k=this._getState?this._getState():void 0;let f=e,g=t,C=s;if(k&&k.backend&&k.backend.isCollaborationPermissionsEnabled()){f=f.filter((({content:e})=>!!e));const e=[];t.forEach(((t,s)=>{t.content?P(k,t)||(f=f.push(t),e.push(s)):P(k,t)?(C=C.push(t.id),e.push(s)):e.push(s)})),g=g.filter(((t,s)=>!e.includes(s))),C=C.filter((e=>k.annotations.has(e)||this._existingFormFieldValuesIds.has(e)||this._existingFormFieldsIds.has(e)||this._existingCommentIds.has(e)||this._existingBookmarksIds.has(e)))}let j=Object(a.a)().withMutations((e=>{this._filterRecords(f).forEach((({id:t,content:s,permissions:i,group:a})=>{const u={permissions:i,group:a};try{Object(c.l)(s)?(l.push(Object(c.e)(t,s,u)),this._existingFormFieldsIds=this._existingFormFieldsIds.add(t)):Object(c.m)(s)?(d=d.push(Object(c.f)(s)),this._existingFormFieldValuesIds=this._existingFormFieldValuesIds.add(t)):Object(c.j)(s)?(n=n.push(Object(r.a)(t,s)),this._existingBookmarksIds=this._existingBookmarksIds.add(t)):Object(c.k)(s)?(this._existingCommentIds=this._existingCommentIds.add(t),h=h.push(Object(c.d)(t,s,u))):Object(c.n)(s)||e.push(Object(c.c)(t,s,u))}catch(e){Object(o.j)(`Skipped creating record #${t} from payload because an error occurred while deserializing.`,s),Object(o.j)(e)}}))}));const O=!k||Object(B.p)(k.features,k.signatureFeatureAvailability);l.length>0&&(Object(o.k)(this._formFieldCallbacks),k&&!O?this._formFieldCallbacks.createFormFields(Object(a.a)(l.filter((e=>!(e instanceof V.i)))),i):this._formFieldCallbacks.createFormFields(Object(a.a)(l),i)),d.size>0&&(Object(o.k)(this._formFieldValueCallbacks),k&&!O&&(d=d.filter((e=>{const t=l.find((t=>t.name===e.name))||k.formFields.get(e.formFieldName);return!(t&&t instanceof V.i)}))),this._formFieldValueCallbacks.createFormFieldValues(Object(a.a)(d),i)),j.size>0&&(Object(o.k)(this._annotationCallbacks),k&&!O&&(j=j.filter((e=>{if(!(e instanceof U.fb))return e;const t=l.find((t=>t.name===e.formFieldName))||k.formFields.get(e.formFieldName);return!(t&&t instanceof V.i)}))),this._annotationCallbacks.createAnnotations(j,Object(a.b)(),i)),h.size>0&&(Object(o.k)(this._commentCallbacks),this._commentCallbacks.createComments(h,i)),n.size>0&&(Object(o.k)(this._bookmarkCallbacks),this._bookmarkCallbacks.createBookmarks(n,i));const F=Object(a.a)().asMutable(),y=[],w=[],I=[],v=Object(a.a)().withMutations((e=>{this._filterRecords(g).map((({id:t,content:s,group:i,permissions:n})=>{const a={permissions:n,group:i};try{if(Object(c.l)(s))try{y.push(Object(c.e)(t,s,a))}catch(e){b=b.add(t),Object(o.j)(`Skipped updating form field #${t} from payload because an error occurred while deserializing. To avoid issues, we have removed the previous version from the application state.`,s),Object(o.j)(e)}else if(Object(c.m)(s))try{w.push(Object(c.f)(s))}catch(e){p=p.add(t),Object(o.j)(`Skipped updating form field value #${t} from payload because an error occurred while deserializing. To avoid issues, we have removed the previous version from the application state.`,s),Object(o.j)(e)}else if(Object(c.j)(s))try{F.push(Object(r.a)(t,s))}catch(e){m=m.add(t),Object(o.j)(`Skipped updating bookmark #${t} from payload because an error occurred while deserializing. To avoid issues, we have removed the previous version from the application state.`,s),Object(o.j)(e)}else if(Object(c.k)(s))try{I.push(Object(c.d)(t,s,a))}catch(e){_=_.add(t),Object(o.j)(`Skipped updating comment #${t} from payload because an error occurred while deserializing. To avoid issues, we have removed the previous version from the application state.`,s,e)}else e.push(Object(c.c)(t,s,a))}catch(e){u=u.add(t),Object(o.j)(`Skipped updating annotation #${t} from payload because an error occurred while deserializing. To avoid issues, we have removed the previous version from the application state.`,s),Object(o.j)(e)}}))}));v.size>0&&(Object(o.k)(this._annotationCallbacks),this._annotationCallbacks.updateAnnotations(v)),F.size>0&&(Object(o.k)(this._bookmarkCallbacks),this._bookmarkCallbacks.updateBookmarks(F)),y.length>0&&(Object(o.k)(this._formFieldCallbacks),this._formFieldCallbacks.updateFormFields(Object(a.a)(y))),w.length>0&&(Object(o.k)(this._formFieldValueCallbacks),this._formFieldValueCallbacks.setFormFieldValues(Object(a.a)(w))),I.length>0&&(Object(o.k)(this._commentCallbacks),this._commentCallbacks.updateComments(Object(a.a)(I))),u=u.concat(C.filter((e=>!(this._existingBookmarksIds.has(e)||this._existingFormFieldsIds.has(e)||this._existingFormFieldValuesIds.has(e)||this._existingCommentIds.has(e)))).toSet()),u.size>0&&(Object(o.k)(this._annotationCallbacks),this._annotationCallbacks.deleteAnnotations(u)),m=m.concat(C.filter((e=>{const t=this._existingBookmarksIds.has(e);return t&&(this._existingBookmarksIds=this._existingBookmarksIds.delete(e)),t})).toSet()),m.size>0&&(Object(o.k)(this._bookmarkCallbacks),this._bookmarkCallbacks.deleteBookmarks(m)),b=b.concat(C.filter((e=>{const t=this._existingFormFieldsIds.has(e);return t&&(this._existingFormFieldsIds=this._existingFormFieldsIds.delete(e)),t})).toSet()),b.size>0&&(Object(o.k)(this._formFieldCallbacks),this._formFieldCallbacks.deleteFormFields(b)),p=p.concat(C.filter((e=>{const t=this._existingFormFieldValuesIds.has(e);return t&&(this._existingFormFieldValuesIds=this._existingFormFieldValuesIds.delete(e)),t})).toSet()),p.size>0&&(Object(o.k)(this._formFieldValueCallbacks),this._formFieldValueCallbacks.deleteFormFieldValues(p)),_=_.concat(C.filter((e=>{const t=this._existingCommentIds.has(e);return t&&(this._existingCommentIds=this._existingCommentIds.delete(e)),t})).toSet()),_.size>0&&(Object(o.k)(this._commentCallbacks),this._commentCallbacks.deleteComments(_))}_onAcceptedRecords(e,t){const s=this._getState?this._getState():void 0;if(!s||!s.backend||!s.backend.isCollaborationPermissionsEnabled())return;const i=[],n=[],c=[],r=[],l=[],d=[];function h(e){const t={permissions:e.permissions,group:e.group};let a=S(s,e);if(a&&"string"!=typeof a){Object(T.c)(t);const e=Object(T.a)(t);a=a.merge(e),a instanceof q.a?t.permissions&&t.permissions.view?i.push(a):r.push(a.id):a instanceof A.a?t.permissions&&t.permissions.view?n.push(a):(Object(o.k)(a.id),l.push(a.id)):a instanceof E.a&&(t.permissions&&t.permissions.view?c.push(a):d.push(a.id))}}e.isEmpty()||e.forEach(h),t.isEmpty()||t.forEach(h),i.length>0&&(Object(o.k)(this._annotationCallbacks),this._annotationCallbacks.updateAnnotations(Object(a.a)(i),!0)),n.length>0&&(Object(o.k)(this._commentCallbacks),this._commentCallbacks.updateComments(Object(a.a)(n))),c.length>0&&(Object(o.k)(this._formFieldCallbacks),this._formFieldCallbacks.updateFormFields(Object(a.a)(c))),r.length>0&&(Object(o.k)(this._annotationCallbacks),this._annotationCallbacks.deleteAnnotations(Object(a.g)(r),!0)),l.length>0&&(Object(o.k)(this._commentCallbacks),this._commentCallbacks.deleteComments(Object(a.g)(l))),d.length>0&&(Object(o.k)(this._formFieldCallbacks),this._formFieldCallbacks.deleteFormFields(Object(a.g)(d)))}onClientsChange(e){if("function"!=typeof e)throw new TypeError("Callback must be a function");this.onClientsChangeCallback=e}_onClientsChange(e){this.onClientsChangeCallback.call(null,e)}}}}]);